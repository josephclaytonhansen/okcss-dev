import db from"./mongo.js";import express from"express";import cors from"cors";import dotenv from"dotenv";import rate_limit from"express-rate-limit";import session from"express-session";import passport from"passport";import{default as connectMongoDBSession}from"connect-mongodb-session";import cookieParser from"cookie-parser";import event_routes from"./routes/eventRoutes.js";import person_routes from"./routes/personRoutes.js";import worship_routes from"./routes/worshipRoutes.js";import tool_routes from"./routes/toolRoutes.js";const app=express();app.use(express.urlencoded({extended:!1})),app.use(cookieParser(process.env.COOKIE_PARSER_SECRET));const MongoDBStore=connectMongoDBSession(session),store=new MongoDBStore({uri:process.env.MONGO_STRING,databaseName:"development",collection:"sessions"});app.use(session({maxAge:432e6,secret:process.env.SESSION_SECRET,resave:!1,saveUninitialized:!0,cookie:{secure:"production"==process.env.ENV,maxAge:432e6},store:store})),app.use(passport.session()),app.use(passport.initialize()),passport.serializeUser((async function(s,e){e(null,s.id)})),passport.deserializeUser((function(s,e){User.findById(s).then((s=>{e(null,s)}))})),dotenv.config(),app.use(express.json()),app.use(express.urlencoded({extended:!1}));const corsOptions={origin:process.env.ORIGIN,credentials:!0,optionSuccessStatus:200};app.use(cors(corsOptions)),app.options("*",cors(corsOptions));const limiter=rate_limit({windowMs:9e5,max:400,standardHeaders:!0,legacyHeaders:!1});"production"==process.env.ENV&&app.use(limiter),app.get("/",((s,e)=>{e.send("Hello World!")})),app.use("/api/events",event_routes),app.use("/api/persons",person_routes),app.use("/api/worships",worship_routes),app.use("/api/tools",tool_routes),app.listen(process.env.PORT,(()=>{}));