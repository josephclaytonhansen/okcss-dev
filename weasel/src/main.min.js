import{createApp}from"vue";import{createPinia}from"pinia";import piniaPluginPersistedState from"pinia-plugin-persistedstate";import{createRouter,createWebHistory}from"vue-router";import{userStore}from"./userStore";import App from"./App.vue";import"./style.css";import axios from"axios";const pinia=createPinia();pinia.use(piniaPluginPersistedState);export{pinia};const app=createApp(App),router=createRouter({history:createWebHistory(),routes:[{path:"/weasel",component:()=>import("./views/Weasel.vue"),props:e=>({ward:"Moore"})},{path:"/:ward",component:()=>import("./views/WardWrapper.vue"),props:e=>({ward:e.params.ward.toLowerCase()})},{path:"/weasel/login",component:()=>import("./views/Login.vue")}]});router.beforeEach((async(e,t,r)=>{let o=localStorage.getItem("user");if(e.path.startsWith("/weasel")&&!e.path.startsWith("/weasel/login")){let e=localStorage.getItem("token");if(e&&o){let t={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Control-Allow-Origin":"*"}},a="https://weasel.okcsouthstake.org/api/users/verify",p={token:e,user:o};try{200===(await axios.post(a,p,t)).status?r():(localStorage.clear(),r("/weasel/login"))}catch(e){localStorage.clear(),r("/weasel/login")}}else localStorage.clear(),r("/weasel/login")}else r()})),app.use(router),app.use(pinia),app.mount("#app");