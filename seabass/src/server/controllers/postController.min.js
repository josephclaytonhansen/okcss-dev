import asyncHandler from"../middleware/asyncHandler.min.js";import Post from"../models/postModel.min.js";const getPosts=asyncHandler((async(t,s)=>{const a=await Post.find({});s.json(a)})),getPostById=asyncHandler((async(t,s)=>{const a=await Post.findById(t.params.id);if(!a)throw s.status(404),new Error("post not found");s.json(a)})),deletePostHistory=asyncHandler((async(t,s)=>{const a=await Post.findById(t.params.id);if(!a)throw s.status(404),new Error("post not found");a.history=[];await Post.findByIdAndUpdate({_id:t.params.id},{history:a.history})?s.json({message:"post history deleted"}):s.status(400).json({message:"invalid data"})})),updatePostHistory=asyncHandler((async(t,s)=>{const a=await Post.findById(t.params.id);if(!a)throw s.status(404),new Error("post not found");a.history.push(a.content);await Post.findByIdAndUpdate({_id:t.params.id},{history:a.history})?s.json({message:"post history updated"}):s.status(400).json({message:"invalid data"})})),updatePost=asyncHandler((async(t,s)=>{const{title:a,slug:o,author:e,categories:n,tags:d,status:r,content:i,featuredImage:u,metaTitle:y,metaDescription:c,metaKeywords:p}=t.body,l=await Post.findById(t.params.id);if(!l)throw s.status(404).json({message:"post not found"}),new Error("post not found");l.title=a;await Post.findByIdAndUpdate(t.params.id,{title:a,slug:o,status:r,content:i,featured_image:u,meta_title:y,meta_description:c,meta_keywords:p})?s.json({message:"post updated"}):s.status(400).json({message:"invalid data"})})),publishPost=asyncHandler((async(t,s)=>{const a=await Post.findById(t.params.id);if(!a)throw s.status(404).json({message:"post not found"}),new Error("post not found");a.status="published";await Post.findByIdAndUpdate(t.params.id,{status:"published"})?s.json({message:"post published"}):s.status(400).json({message:"invalid data"})})),deletePost=asyncHandler((async(t,s)=>{const a=await Post.findById(t.params.id);if(!a)throw s.status(404),new Error("post not found");await a.remove(),s.json({message:"post removed"})})),createPost=asyncHandler((async(t,s)=>{const{title:a,slug:o,author:e,categories:n,status:d,content:r,featuredImage:i,metaTitle:u,metaDescription:y,metaKeywords:c,scheduledDate:p}=t.body,l=await Post.create({title:a,slug:o,author:e,categories:n,status:d,content:r,featured_image:i,meta_title:u,meta_description:y,meta_keywords:c,scheduled_date:p});if(!l)throw s.status(404),new Error("post not found");s.json(l)})),getPostBySlug=asyncHandler((async(t,s)=>{const a=await Post.findOne({slug:t.params.slug});if(!a)throw s.status(404),new Error("post not found");s.json(a)})),getPostsByAuthor=asyncHandler((async(t,s)=>{const a=await Post.find({author:t.params.author});if(!a)throw s.status(404),new Error("posts not found");s.json(a)})),getPostsByStatus=asyncHandler((async(t,s)=>{const a=await Post.find({status:t.params.status});if(!a)throw s.status(404),new Error("posts not found");s.json(a)})),getPostsByCategory=asyncHandler((async(t,s)=>{const a=await Post.find({category:t.params.category});if(!a)throw s.status(404),new Error("posts not found");s.json(a)})),getUpcomingPosts=asyncHandler((async(t,s)=>{let a=new Date;const o=await Post.find({status:"scheduled",scheduledDate:{$gte:a},limit:3});if(!o)throw s.status(404),new Error("posts not found");s.json(o)}));export{getPosts,getPostById,updatePost,updatePostHistory,deletePostHistory,deletePost,createPost,getPostBySlug,getPostsByAuthor,getPostsByStatus,getPostsByCategory,getUpcomingPosts,publishPost};