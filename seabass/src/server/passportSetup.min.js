import passport from"passport";import User from"./models/userModel.min.js";import googleAuthenticator from"passport-2fa-totp";import Strategy from"passport-2fa-totp";passport.use(new Strategy((function(e,t,r){User.findOne({username:e},(function(e,o){return e?r(e):o&&o.verifyPassword(t)?r(null,o):r(null,!1)}))}),(function(e,t){if(e.secret){var r=googleAuthenticator.decodeSecret(e.secret);t(null,r,30)}else googleAuthenticator.generateSecret({name:"Blog Front End Editor",account:e.username},(function(r,o){if(r)return t(r);e.secret=o,e.save((function(r){if(r)return t(r);var n=googleAuthenticator.generateOtpauthUrl({secret:o,label:"Blog Front End Editor",account:e.username});t(null,n)}))}))}))),passport.serializeUser((function(e,t){t(null,e.id)})),passport.deserializeUser((function(e,t){User.findById(e,(function(e,r){t(e,r)}))}));